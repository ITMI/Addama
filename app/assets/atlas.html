<!doctype html>
<!--<html lang="en">-->
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <link rel="shortcut icon" href="img/isbfavicon.ico" type="image/x-icon"/>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=1024">
    <meta name="viewport" content="initial-scale=1.0, width=device-width, height=device-height, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>QED: Atlas</title>
    <meta name="viewport" content="width=1024"/>

    <link rel="stylesheet" href="css/app.css">
    <script src="js/vendor.js"></script>
    <script src="js/app.js"></script>
    <script>require('initialize');</script>
</head>

<body>

<div class="navbar navbar-fixed-top" id="navigation-container"></div>

<div class="cancer-items">
    <ul class="nav nav-pills cancer-selector"></ul>
</div>

<div class="pull-right gene-items">
    <ul class="nav nav-list">
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Genes <b class="caret"></b></a>
            <input class="genes-typeahead" type="text" placeholder="Add a gene..."/>
            <ul class="dropdown-menu gene-selector">
                <li><a href='#' onclick='return false;' class='item-remover' data-id='TP53'>TP53 <i class='icon-trash'></i> </a></li>
                <li><a href='#' onclick='return false;' class='item-remover' data-id='CTCF'>CTCF <i class='icon-trash'></i> </a></li>
            </ul>
        </li>
    </ul>
</div>

<div class="atlas-body">
    <div class="atlas-canvas zoomContainer">
        <div class="atlas-container">
            <div id="map-aberrations" class="atlas-map small">
                <label>Aberrations</label>
                <ul class="nav nav-pills pull-right">
                    <li><a href="#" onclick="return false;" class="goto-summary"> <i class="icon-zoom-in"/></i> </a></li>
                </ul>
                <div class="map-contents container-fluid outer-container"></div>
            </div>

            <div id="map-features" class="atlas-map small"
                 data-small="#v/domains/newMerge.05nov/brca.newMerge.05nov.tsv/xfeaturegrid_small"
                 data-medium="#v/domains/newMerge.05nov/brca.newMerge.05nov.tsv/xfeaturegrid"
                 data-big="#v/domains/newMerge.05nov/brca.newMerge.05nov.tsv/heat">
                <div>
                    <label>Features</label>
                    <ul class="nav nav-pills pull-right">
                        <li><a href="#" onclick="return false;" class="goto-summary"> <i class="icon-zoom-in"/></i> </a></li>
                    </ul>
                </div>
                <div class="map-contents container-fluid outer-container"></div>
            </div>

            <div id="map-associations" class="atlas-map small">
                <label>Associations</label>
                <ul class="nav nav-pills pull-right">
                    <li><a href="#" onclick="return false;" class="goto-summary"> <i class="icon-zoom-in"/></i> </a></li>
                </ul>
                <div class="map-contents container-fluid outer-container"></div>
            </div>

            <div id="map-literature" class="atlas-map small">
                <label>Literature</label>
                <ul class="nav nav-pills pull-right">
                    <li><a href="#" onclick="return false;" class="goto-summary"> <i class="icon-zoom-in"/></i> </a></li>
                </ul>
                <div class="map-contents container-fluid outer-container"></div>
            </div>

            <div id="map-clinical" class="atlas-map small">
                <label>Clinical</label>
                <ul class="nav nav-pills pull-right">
                    <li><a href="#" onclick="return false;" class="goto-summary"> <i class="icon-zoom-in"/></i> </a></li>
                </ul>
                <div class="map-contents container-fluid outer-container"></div>
            </div>
        </div>
        <div class="atlas-summary">
            <label>Summary</label>
            <ul class="nav nav-list pull-right">
                <li><a href="#" onclick="return false;" class="goto-container-from-summary"> <i class="icon-home"/></i> </a></li>
                <li><a href="#" onclick="return false;" class="goto-details-from-summary"> <i class="icon-zoom-in"/></i> </a></li>
                <li><a href="#" onclick="return false;" class="goto-container-from-summary"> <i class="icon-zoom-out"/></i> </a></li>
            </ul>
            <div class="map-contents container-fluid outer-container"></div>
        </div>
        <div class="atlas-details">
            <label>Details</label>
            <ul class="nav nav-list pull-right">
                <li><a href="#" onclick="return false;" class="goto-container-from-details"> <i class="icon-home"/></i> </a></li>
                <li class="disabled"><a href="#" onclick="return false;"> <i class="icon-zoom-in"/></i> </a></li>
                <li><a href="#" onclick="return false;" class="goto-summary-from-details"> <i class="icon-zoom-out"/></i> </a></li>
            </ul>
            <div class="map-contents container-fluid outer-container"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var atlas;
    $(function () {
        var Atlas = require("lib/atlas");
        atlas = new Atlas($(".atlas-body"));

        var readyContainerFn = function() {
            _.each($(".atlas-container").find(".atlas-map"), function(atlasMap) {
                atlas.navigate($(atlasMap).find(".map-contents"), $(atlasMap).data("small"));
            });
        };

        qed.Events.on("ready", readyContainerFn);

        var data_medium;
        var data_big;
        $(".goto-summary").click(function(e) {
            var target = $(e.target).parents(".atlas-map");
            data_medium = target.data("medium");
            data_big = target.data("big");

            atlas.transitions("zoomout", ".atlas-container", ".atlas-summary", function() {
                $(".atlas-container").find(".map-contents").empty();
                atlas.navigate($(".atlas-summary").find(".map-contents"), data_medium);
            });
        });

        $(".goto-details-from-summary").click(function(e) {
            atlas.transitions("zoomout", ".atlas-summary", ".atlas-details", function() {
                $(".atlas-summary").find(".map-contents").empty();
                _.delay(function() {
                    atlas.navigate($(".atlas-details").find(".map-contents"), data_big);
                }, 2000);
            });
        });

        $(".goto-container-from-summary").click(function(e) {
            atlas.transitions("zoomin", ".atlas-summary", ".atlas-container", function() {
                $(".atlas-summary").find(".map-contents").empty();
                readyContainerFn();
            });
        });

        $(".goto-summary-from-details").click(function(e) {
            atlas.transitions("zoomin", ".atlas-details", ".atlas-summary", function() {
                atlas.navigate($(".atlas-summary").find(".map-contents"), data_medium);
            });
        });

        $(".goto-container-from-details").click(function(e) {
            atlas.transitions("zoomin", ".atlas-details", ".atlas-container", function() {
                $(".atlas-details").find(".map-contents").empty();
                readyContainerFn();
            });
        });

        $(".atlas-map").draggable({ "scroll": true });
        $(".atlas-map").resizable({ "animate": false });
    });
</script>

<!--these scripts are to support lightweight google hangout integration, should not affect how the app runs outside of hangout-->
<!--<script src="//hangoutsapi.talkgadget.google.com/talkgadget/apps/gadgets/js/rpc.js"></script>-->
<!--<script src="//hangoutsapi.talkgadget.google.com/hangouts/api/hangout.js?v=1.0"></script>-->

</body>
</html>

