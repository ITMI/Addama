<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-url-parser/2.3.1/purl.min.js"></script>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css"/>
</head>
<body>

<div class="jumbotron">
    <h3>Addama API Console</h3>
    <p><a class="btn btn-primary btn-sm" role="button" href="https://github.com/IlyaLab/Addama/blob/master/APIs.md">Learn more</a></p>
    <a href="https://github.com/IlyaLab/Addama" target="_blank">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
             src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67"
             alt="Fork me on GitHub"
             data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png">
    </a>
</div>

<div class="container">
    <div class="row">
        <ol class="breadcrumb">
        </ol>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="well">
                <pre id="output_region"></pre>
            </div>
        </div>
        <div class="col-md-4">
            <kbd id="curl_region"></kbd>
        </div>
    </div>
</div>

<script type="text/javascript">
    console.log("root={{root}}");
    console.log("url={{url}}");

    $("#curl_region").html("curl " + document.location.href);

    $(".breadcrumb").empty();
    $(".breadcrumb").append("<li><a href='/' target='_self'>$root</a></li>");

    var breadcrumb_href = "{{root}}";
    var parts = _.compact("{{url}}".split("/"));
    _.each(parts, function(part, idx) {
        if (!_.isEqual(breadcrumb_href, "/")) breadcrumb_href += "/";
        breadcrumb_href += part;

        console.log("part=" + part + "," + idx + ":" + breadcrumb_href);
        if (_.isEqual(idx + 1, parts.length)) {
            $(".breadcrumb").append("<li class='active'>" + part + "</li>");
        } else {
            $(".breadcrumb").append("<li><a href='" + breadcrumb_href + "' target='_self'>" + part + "</a></li>");
        }

    });

    var __uris2hrefs = function(item) {
        if (_.has(item, "uri")) {
            var uri = item["uri"];
            item["uri"] = "<a href='" + uri + "' target='_self'>" + uri + "</a>";
        }
    };

    var __display_json = function(data) {
        $("#output_region").html(JSON.stringify(data, undefined, 2));
    };

    $.ajax({
        "method": "get",
        "url": "{{url}}",
        "headers": {
            "Accept": "application/json"
        },
        "cache": false,
        "success": function(data) {
            if (_.isArray(data)) {
                _.each(data, __uris2hrefs);
                __display_json(data);

            } else if (_.isObject(data)) {
                __uris2hrefs(data);
                __display_json(data);

            } else if (_.isString(data)) {
                data = JSON.parse(data);
                _.each(data, function(item) {
                    if (_.isArray(item)) {
                        _.each(item, __uris2hrefs);
                    }
                    __uris2hrefs(item);
                });
                __uris2hrefs(data);
                __display_json(data);
            }

            $(".data_link").click(function(e) {
                var $data_link = $(e.target);
                document.location = $data_link.data("url");
            });
        }
    });
</script>
</body>
</html>